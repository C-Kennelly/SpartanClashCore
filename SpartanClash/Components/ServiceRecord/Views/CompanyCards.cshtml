@using ServiceRecord.ViewModels;
@using System.Globalization;
@model IOrderedEnumerable<ClanBattle>

<link rel="stylesheet" href="~/css/game-result-card.css" />
<script src="~/js/game-result-card.js"></script>

@{

    ViewData["Title"] = "Company Results";

    Layout = "~/Components/_SharedViews/_Layout.cshtml";

    string companyName = Model.FirstOrDefault().primaryCompany;

}

<div class="company-title-header">
    <h1><b>@companyName</b></h1>
    <h3>Last refresh: @ViewData["LastRefreshDate"]</h3>

    <div class="filter-controls">
        <div class="filter-item">
            <button onclick="showDropdownContent('opponent-dropdown')" id="opponent-filter-btn" class="filter-btn">
                <h5>Against everyone</h5>
            </button>
            <div id="opponent-dropdown" class="dropdown-content">
                <p>Against everyone</p>
                <p>Clans only</p>
            </div>
        </div>
        
        <div class="filter-item">
            <button onclick="showDropdownContent('date-dropdown')" id="date-filter-btn" class="filter-btn">
                <h5>Since launch day</h5>
            </button>
            <div id="date-dropdown" class="dropdown-content">
                <p>Since launch day</p>
                <p>Since last refresh</p>
            </div>
        </div>

        <div class="filter-item">
            <button onclick="showDropdownContent('mode-dropdown')" id="mode-filter-btn" class="filter-btn">
                <h5>For all modes</h5>
            </button>
            <div id="mode-dropdown" class="dropdown-content">
                <p>For all modes</p>
                <p>Arena only</p>
                <p>Warzone only</p>
            </div>
        </div>
    </div>
</div>

@if (Model.Count() == 1)
{
    <h4>@companyName has only 1 match on record:</h4>
}
else
{
    double winCount = Model.Where(x => x.isWin == true).Count();
    double lossCount = Model.Count() - winCount;

    string winRatio;
    if (lossCount < 1)
    {
        winRatio = "--";
    }
    else
    {
        double ratioCalc = winCount / lossCount;
        winRatio = ratioCalc.ToString("0.00");
    }

    <div class="game-result-summation">
        <h4>Wins:</h4>
        <h4><b><u>@winCount</u></b></h4>
        <h4>Losses:</h4>
        <h4><b><u>@lossCount</u></b></h4>
        <h4>Ratio:</h4>
        <h4><b><u>@winRatio</u></b></h4>
    </div>

}

@foreach (ClanBattle battle in Model)
{

    @if (battle.GetTeam() == 1)
    {
        <div class="game-result-card" id="accordion">
            <div class="team-result team-result-ally team-result-red">
                <h2>@battle.score</h2>
                <h3>@battle.primaryCompany</h3>
            </div>
            <div class="game-result-spacer-red-active"></div>
            <div class="team-result team-result-enemy team-result-blue">
                <h2>@battle.enemyScore</h2>
                @if (battle.isClanBattle)
                {   <h3 class="enemy-header-link"><a asp-controller="ServiceRecord" asp-action="CompanyCards" asp-route-company="@battle.enemyHeader">@battle.enemyHeader</a></h3> }
                else
                {   <h3 >@battle.enemyHeader</h3> }
            </div>
        </div>
    }
    else
    {
        <div class="game-result-card" id="accordion">
            <div class="team-result team-result-ally team-result-blue">
                <h2>@battle.score</h2>
                <h3>@battle.primaryCompany</h3>
            </div>
            <div class="game-result-spacer-blue-active"></div>
            <div class="team-result team-result-enemy team-result-red">
                <h2>@battle.enemyScore</h2>
                @if (battle.isClanBattle)
                {   <h3 class="enemy-header-link"><a asp-controller="ServiceRecord" asp-action="CompanyCards" asp-route-company="@battle.enemyHeader">@battle.enemyHeader</a></h3> }
                else
                {   <h3>@battle.enemyHeader</h3> }
            </div>
        </div>
    }

}